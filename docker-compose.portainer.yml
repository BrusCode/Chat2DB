version: '3.8'

services:
  chat2db:
    image: chat2db/chat2db:latest
    container_name: chat2db-portainer
    restart: unless-stopped
    
    # Portas
    ports:
      - "${CHAT2DB_PORT:-10824}:10824"
    
    # Volumes para persistência de dados
    volumes:
      - chat2db_data:/root/.chat2db
      # Volume adicional para backups (opcional)
      # - ./backups:/backups
    
    # Variáveis de ambiente
    environment:
      # Configurações Java
      - JAVA_OPTS=-Xmx${JAVA_MAX_MEMORY:-2g} -Xms${JAVA_MIN_MEMORY:-512m}
      
      # Configurações da aplicação
      - TZ=${TIMEZONE:-America/Sao_Paulo}
      
      # Configurações opcionais de AI (ChatGPT)
      # Descomente e configure se quiser usar recursos de IA
      # - CHATGPT_API_KEY=${CHATGPT_API_KEY:-}
      # - CHATGPT_API_HOST=${CHATGPT_API_HOST:-https://api.openai.com}
    
    # Labels para organização no Portainer
    labels:
      - "com.docker.compose.project=chat2db"
      - "app.name=Chat2DB"
      - "app.description=AI-powered SQL client and database management tool"
      - "app.version=latest"
      - "maintainer=BrusCode"
    
    # Healthcheck para monitoramento
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:10824/api/system/get-version-a"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    # Limites de recursos (ajuste conforme necessário)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 1G
    
    # Configurações de rede
    networks:
      - chat2db_network
    
    # Política de logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Volumes nomeados para persistência
volumes:
  chat2db_data:
    driver: local
    labels:
      - "app.name=Chat2DB"
      - "app.data=persistent"

# Rede customizada
networks:
  chat2db_network:
    driver: bridge
    labels:
      - "app.name=Chat2DB"
